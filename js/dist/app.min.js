function getToDosAJAX(){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"getToDo"},dataType:"JSON",success:function(t){"success"==t.status?$.each(t.data,function(t,a){createToDo(a)}):console.log(t.response)}})}function getTasksAJAX(t){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"getTasks",id:t},dataType:"JSON",success:function(a){"success"==a.status?($(".todo#todo_"+t+" table").empty(),$.each(a.data,function(a,e){insertTask(t,e)}),insertTaskAdd(t,!0)):console.log(a.response)}})}function swapTasksAJAX(t,a){function e(){return $.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"swapTasks",id1:t,id2:a},dataType:"JSON",success:function(t){"success"==t.status?o=!0:console.log(t.response)}})}var o=!1;$.when(e()).done(function(){return o})}function changeTaskStatusAJAX(t){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"changeTaskStatus",id:t},dataType:"JSON",success:function(t){"success"==t.status||console.log(t.response)}})}function changeTaskContentAJAX(t,a){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"changeTaskContent",id:t,content:a},dataType:"JSON",success:function(t){"success"==t.status||console.log(t.response)}})}function removeTaskAJAX(t){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"removeTask",id:t},dataType:"JSON",success:function(t){"success"==t.status||console.log(t.response)}})}function addTask(t,a){var e=NaN;return $.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"addTask",idToDo:t,content:a},dataType:"JSON",success:function(t){"success"==t.status?(removeTaskAdd(t.data.Id_todo),insertTask(t.data.Id_todo,t.data),insertTaskAdd(t.data.Id_todo,!0)):console.log(t.response)}}),!isNaN(e)&&e}function changeToDoTitleAJAX(t,a){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"changeToDoTitle",idToDo:t,title:a},dataType:"JSON",success:function(t){"success"==t.status||console.log(t.response)}})}function removeToDoAJAX(t){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"removeToDo",idToDo:t},dataType:"JSON",success:function(t){"success"==t.status||console.log(t.response)}})}function addToDoAJAX(t,a){$.ajax({type:"POST",url:"/ajax/todo.php",data:{action:"addToDo",title:t,cat_id:a},dataType:"JSON",success:function(t){"success"==t.status?createToDo(t.data):console.log(t.response)}})}function createToDo(t){$(".todo-wrapper").append('<div class="todo cat_'+t.Cat_id+'" id="todo_'+t.ID+'"><div class="todo-header"> <h2 class="title">'+t.Title+'</h2> <span class="add-date">Dodano: '+t.Add_date+'</span> <div class="menu"> <div class="nav"> <div class="move-up"><i class="fa fa-caret-up" aria-hidden="true"></i></div> <div class="move-down"><i class="fa fa-caret-down" aria-hidden="true"></i></div> </div> <div class="actions"> <div class="edit"><i class="fa fa-pencil" aria-hidden="true"></i></div> <div class="delete"><i class="fa fa-trash-o" aria-hidden="true"></i></div> </div> </div> <div class="show-tasks"><i class="fa fa-chevron-down" aria-hidden="true"></i></div> </div><div class="todo-tasks" style="display: none;"><table></table></div></div>'),$("#todo_"+t.ID+" .show-tasks").on("click",function(){loadTasks(this),taskToggleClick(this)}),$("#todo_"+t.ID+" .move-up").on("click",function(){moveToDoUp($("#todo_"+t.ID))}),$("#todo_"+t.ID+" .move-down").on("click",function(){moveToDoDown("#todo_"+t.ID)}),$("#todo_"+t.ID+" .edit").on("click",function(){editToDoTitle("#todo_"+t.ID)}),$("#todo_"+t.ID+" .title").on("dblclick",function(){editToDoTitle("#todo_"+t.ID)}),$("#todo_"+t.ID+" .delete").on("click",function(){removeToDo("#todo_"+t.ID)})}function insertTask(t,a){var e="",o="fa-square-o";a.Done&&(e="done",o="fa-check"),$(".todo#todo_"+t+" table").append('<tr class="task '+e+'" id="task_'+a.Id_task+'"> <td class="check-box-cell"> <div class="check-box"><i class="fa '+o+'" aria-hidden="true"></i></div> </td> <td class="content-cell"> <span class="content">'+a.Content+'</span> </td> <td class="edit-box-cell"><div class="edit-box"><i class="fa fa-pencil" aria-hidden="true"></i></div> </td> <td class="del-box-cell"> <div class="del-box"><i class="fa fa-trash-o" aria-hidden="true"></i></div> </td> </tr>'),$("#task_"+a.Id_task+" .check-box-cell").on("click",function(){var t=Number($(this).parent().attr("id").replace("task_",""));changeTaskStatusAJAX(t),toggleDoneTask(this)}),$("#task_"+a.Id_task+" .edit-box-cell").on("click",function(){editTask(this)}),$("#task_"+a.Id_task+" .content-cell").on("dblclick",function(){editTask(this)}),$("#task_"+a.Id_task+" .del-box-cell").on("click",function(){removeTask(this)})}function insertTaskAdd(t,a){$(".todo#todo_"+t+" table").append('<tr class="task add-task" > <td></td> <td class="input-cell"> <input name="input-content" type="text" placeholder="Dodaj nową notatkę..."> </td> <td class="add-box-cell"> <div class="add-box"><i class="fa fa-plus" aria-hidden="true"></i></div> </td><td></td></tr>'),1==a&&$(".todo#todo_"+t+" table .add-task input")[0].focus(),$(".todo#todo_"+t+" .add-box-cell").on("click",function(){var a=$(".todo#todo_"+t+" .add-task input")[0].value;if(a.length>0&&(free_id=getFreeTaskIdAJAX(t),free_id)){var e={Id_task:free_id,Content:a,Done:0};insertTask(t,e),changeTaskContentAJAX(free_id,a),removeTaskAdd(t),insertTaskAdd(t,!0)}}),$(".todo#todo_"+t+" .input-cell input").keypress(function(a){if(13==a.which){var e=$(".todo#todo_"+t+" .add-task input")[0].value;e.length>0&&addTask(t,e)}})}function removeTaskAdd(t){$(".todo#todo_"+t+" table .add-task").remove()}function editToDoTitle(t){var a=Number(t.replace("#todo_",""));if($(t+" .edit i").hasClass("fa-pencil")){var e=$(t+" .title")[0].innerHTML;prev_title=e,$(t+" .title").replaceWith("<input type='text' class='title'>"),$(t+" .title")[0].focus(),$(t+" .title")[0].value=e,$(t+" .edit i").removeClass("fa-pencil").addClass("fa-plus"),$(t+" .title").keypress(function(a){13==a.which&&editToDoTitle(t)})}else{var o=$(t+" .title")[0].value;o!=prev_title&&changeToDoTitleAJAX(a,o),$(t+" .title").replaceWith('<h2 class="title">'+o+"</h2>"),$(t+" .edit i").removeClass("fa-plus").addClass("fa-pencil"),$(t+" .title").on("dblclick",function(){editToDoTitle(t)})}}function removeToDo(t){var a=Number(t.replace("#todo_",""));$(t).remove(),removeToDoAJAX(a)}function moveToDoUp(t){if($(t).prev().length){var a=$(t).attr("id").replace("todo_",""),e=$(t).prev().attr("id").replace("todo_","");swapTasksAJAX(a,e),$(t).hide().insertBefore($(t).prev()).slideDown(300)}}function moveToDoDown(t){if($(t).next().length){var a=$(t).attr("id").replace("todo_",""),e=$(t).next().attr("id").replace("todo_","");swapTasksAJAX(a,e),$(t).hide().insertAfter($(t).next()).slideDown(300)}}function taskToggleClick(t){$(t).parent().next(".todo-tasks").slideToggle(),$(t).toggleClass("fliped")}function loadTasks(t){var a=$(t).hasClass("fliped")?1:0,e=Number($(t).parent().parent().attr("id").replace("todo_","")),o=$("#todo_"+e).hasClass("loaded")?1:0;a||o||showTasks(a,e)}function showTasks(t,a){getTasksAJAX(a),$("#todo_"+a).addClass("loaded")}function editTask(t){var a=Number($(t).parent().attr("id").replace("task_",""));if($.each($(".content"),function(t,a){$(a).width($("#todos").width()-120)}),$("#task_"+a+" .edit-box-cell i").hasClass("fa-pencil")){var e=$("#task_"+a+" .content")[0].innerHTML;$("#task_"+a+" .content-cell")[0].innerHTML='<input type="text" value="'+e+'" class="content content-input"/>',$("#task_"+a+" .edit-box-cell i").removeClass("fa-pencil").addClass("fa-plus"),$("#task_"+a+" .content-input")[0].focus(),$("#task_"+a+" .content-input")[0].value=e,$("#task_"+a+" .content-input").keypress(function(a){13==a.which&&editTask(t)})}else{var o=$("#task_"+a+" .content-input")[0].value,s=$($("#task_"+a+" .content-input")[0]).width();changeTaskContentAJAX(a,o),$("#task_"+a+" .edit-box-cell i").removeClass("fa-plus").addClass("fa-pencil"),$("#task_"+a+" .content-cell")[0].innerHTML='<span class="content">'+o+"</span>",$($("#task_"+a+" .content")[0]).width(s)}}function toggleDoneTask(t){$(t).children().children().hasClass("fa-check")?($(t).children().children().removeClass("fa-check").addClass("fa-square-o"),$(t).parent().removeClass("done")):($(t).children().children().addClass("fa-check").removeClass("fa-square-o"),$(t).parent().addClass("done"))}function removeTask(t){var a=Number($(t).parent().attr("id").replace("task_",""));removeTaskAJAX(a),$("#task_"+a).remove()}var prev_title;$(function(){getToDosAJAX(),$(document).ready(function(){$.each($(".content"),function(t,a){$(a).width($("#todos").width()-120)}),$(window).resize(function(){$.each($(".content"),function(t,a){$(a).width($("#todos").width()-120)})})}),$("#refresh").on("click",function(){$(".todo-wrapper").empty(),getToDosAJAX()}),$(document).on("change",".add-todo select",function(t){var a=this.options[t.target.selectedIndex].value;$(".add-todo")[0].classList=["add-todo"],$(".add-todo").addClass(a)}),$(".add-todo .fa-plus").on("click",function(){var t=$(".add-todo input")[0].value;if(t.length>0){var a=Number($(".add-todo")[0].classList[1].replace("cat_",""));addToDoAJAX(t,a),$(".add-todo input")[0].value=""}}),$(".add-todo input").keypress(function(t){if(13==t.which){var a=$(".add-todo input")[0].value;if(a.length>0){var e=Number($(".add-todo")[0].classList[1].replace("cat_",""));addToDoAJAX(a,e),$(".add-todo input")[0].value=""}}})});